<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:rich="http://richfaces.org/rich"
    template="/layout/template.xhtml">

<style>
.even-row {
   background-color: #fcefa1;
}
.odd-row {
   background-color: #f7f7f7;
}
</style>

<!--  codigo adicionado por WEBER -->
<a:jsFunction name="setHostname"  
	action="#{exameHome.setHostname}" >  
 	<a:actionparam name="hostname" noEscape="true" value="window.location.hostname" assignTo="#{exameHome.hostname}" />    
</a:jsFunction> 

<ui:param name="pageTitle" value="Acompanhamento de Exames" />
<ui:define name="body" onLoad="setHostname()">
    
    <rich:panel ><!--Modificado por Newton em 13/6/2015 para ajustar largura (style="width: 1425px; height: 875px"). Modificado por Weber em 17/06/2015: dimensoes removidas. -->
    	<f:facet name="header">Acompanhamento do Exame</f:facet>
        
        <rich:panel id="media" rendered="#{exameHome.managed}" >
        	
			 <a:outputPanel id="flashPanelDynamic" >
			 
			 <h:inputHidden id="pastaImagens" value="#{exameHome.instance.diretorioArquivos}"/>
			 <h:inputHidden id="pastaVideos" value="#{exameHome.systemConfiguration.defaultFilesDirectory}"/>
			 
			 
			 
        
		        <a:mediaOutput element="a" id="swfLink" cacheable="false" session="true" style="width: 100%; height: 100%"
		            createContent="#{exameHome.paint}" value="#{mediaData}" mimeType="application/x-shockwave-flash" />
		
		        <a:outputPanel layout="block" id="myFlashContent" style="width: 200px; height: 200px">
		            <a href="http://www.adobe.com/go/getflashplayer">
		                <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player" />
		            </a>
		        </a:outputPanel>
		        
		        <a:loadScript src="resource:///org/richfaces/renderkit/html/js/swfobject.js" /> 
		
		        <script type="text/javascript">
		        var dir = document.getElementById("pastaImagens").value;
		        var dir2 = document.getElementById("pastaVideos").value;
		        var flashvars = {};
		        var params = {directory2:dir2, directory:dir};
		        //var params = {directory:dir};
		        var attributes = {};
		        //swfobject.embedSWF(#{rich:element('swfLink')}.href, "#{rich:clientId('myFlashContent')}", "995", "600", "9.0.0", false, flashvars, params, attributes);
		        swfobject.embedSWF(#{rich:element('swfLink')}.href, "#{rich:clientId('myFlashContent')}", "100%", "600", "9.0.0", false, params); 

		        //window.alert(dir); 
		        </script>
		
		    </a:outputPanel>
        	
        	
        </rich:panel>
		
		<h:form>
    			<br></br>
    			<center>
    			<s:button value="Terminar Exame" style="width:250px;height:50px;font-size:20px;" action="#{exameHome.finalizarExame}" onclick="javascript:if(!confirm('Tem certeza que deseja terminar o exame?')) return false;"
    				rendered="#{!exameHome.instance.finalizado and (credentials.username == exameHome.instance.profissional.login)}" >
    				</s:button>			
                    <!-- rendered="#{credentials.username == exameHome.instance.profissional.login}"/> -->
                </center>    				
    			<br></br>
    			<br></br>
    
    	</h:form>

        <s:decorate id="paciente" template="/layout/display.xhtml">
            <ui:define name="label">Paciente</ui:define>
            <h:outputText value="#{exameHome.instance.paciente.nome}"/>
        </s:decorate>
    
        <s:decorate id="profissional" template="/layout/display.xhtml">
            <ui:define name="label">M&#233;dico</ui:define>
            <h:outputText value="#{exameHome.instance.profissional.nome}"/>
        </s:decorate>

        <s:decorate id="marcaEquipamento" template="/layout/display.xhtml">
            <ui:define name="label">Marca do Equipamento</ui:define>
            <h:outputText value="#{exameHome.instance.equipamento.modeloEquipamento.marcaEquipamento.descMarcaEquipamento}"/>
        </s:decorate>

        <s:decorate id="modeloEquipamento" template="/layout/display.xhtml">
            <ui:define name="label">Modelo do Equipamento</ui:define>
            <h:outputText value="#{exameHome.instance.equipamento.modeloEquipamento.descModeloEquipamento}"/>
        </s:decorate>

        <s:decorate id="equipamento" template="/layout/display.xhtml">
            <ui:define name="label">Local do Exame</ui:define>
            <h:outputText value="#{exameHome.instance.equipamento.nmEquipamento}"/>
        </s:decorate>

        <s:decorate id="tipoExame" template="/layout/display.xhtml">
            <ui:define name="label">Tipo do Exame</ui:define>
            <h:outputText value="#{exameHome.instance.tipoExame.descTipoExame}"/>
        </s:decorate>

        <s:decorate id="dtExame" template="/layout/display.xhtml">
            <ui:define name="label">Data do Exame</ui:define>
            <h:outputText value="#{exameHome.instance.dtExame}">
            	<s:convertDateTime type="both" dateStyle="short" pattern="dd/MM/yyyy"/>
            </h:outputText>
        </s:decorate>

        <s:decorate id="convenio" template="/layout/display.xhtml">
            <ui:define name="label">Conv&#234;nio</ui:define>
            <h:outputText value="#{exameHome.instance.convenio.descConvenio}"/>
        </s:decorate>

        <s:decorate id="motivoExame" template="/layout/display.xhtml">
            <ui:define name="label">Motivo do Exame</ui:define>
            <h:outputText value="#{exameHome.instance.motivoExame}"/>
        </s:decorate>

        <s:decorate id="observacoesExame" template="/layout/display.xhtml">
            <ui:define name="label">Observa&#231;&#245;es</ui:define>
            <h:outputText value="#{exameHome.instance.observacoesExame}"/>
        </s:decorate>
                
        <s:decorate id="procedenciaPaciente" template="/layout/display.xhtml">
            <ui:define name="label">Encaminhado Por</ui:define>
            <h:outputText value="#{exameHome.instance.procedenciaPaciente}"/>
        </s:decorate> 

        <div style="clear:both"/>
        
      

    </rich:panel>

   <rich:tabPanel switchType="ajax" rendered="#{exameHome.managed}">
        <rich:tab label="V&#237;deos e &#225;udios">
        <h:form styleClass="association" id="videosChildren">
        <h:outputText value="N&#227;o h&#225; v&#237;deos nem &#225;udios associados a este exame."
                       rendered="#{empty exameHome.videoMetaInformationList}"/>

	<style  type="text/css">
        .odd-row {
            background-color: #ECF3FE;
        }
        .even-row {
            background-color: #FCFFFE;
        }
        .active-row {
            background-color: #FFEBDA;
        }
        
    </style>  

            <rich:dataTable value="#{exameHome.videoMetaInformationList}"
                           var="_video"
                      rendered="#{not empty exameHome.videoMetaInformationList}"
                    rowClasses="even-row, odd-row"
                            id="videosTable"> 
                <rich:column>
                    <f:facet name="header">Hor&#225;rio de in&#237;cio</f:facet>
                    <h:outputText value="#{_video.hourMinuteSecond}"/>
                </rich:column>
                <rich:column>
                    <f:facet name="header">Tamanho</f:facet>
                    <h:outputText value="#{_video.totalBytes} KB"/>
                </rich:column>                     
                <rich:column>
                    <f:facet name="header">Tipo de m&#237;dia</f:facet>
                    <h:outputText value="#{_video.mediaType}"/>
                </rich:column>                             
                <!-- <rich:column sortBy="#{_video.hourMinuteSecond}">
                    <f:facet name="header">Hor&#225;rio</f:facet>
                    <h:outputText value="#{_video.hourMinuteSecond}"/>
                </rich:column>
                <rich:column sortBy="#{_video.duration}">
                    <f:facet name="header">Dura&#231;&#227;o</f:facet>
                    <h:outputText value="#{_video.duration}"/>
                </rich:column>
                <rich:column sortBy="#{_video.totalBytes}">
                    <f:facet name="header">Tamanho</f:facet>
                    <h:outputText value="#{_video.totalBytes}"/>
                </rich:column>-->
                            <!--                
                <rich:column sortBy="#{_laudo.observacao}">
                    <f:facet name="header">Observa&#231;&#245;es</f:facet>
                    <h:outputText value="#{_laudo.observacao}"/>
                </rich:column>
                <rich:column sortBy="#{_laudo.dtLaudo}">
                    <f:facet name="header">Data do laudo</f:facet>
                    <h:outputText value="#{_laudo.dtLaudo}">
                        <s:convertDateTime type="both" dateStyle="short" pattern="dd/MM/yyyy"/>
                    </h:outputText>
                </rich:column>-->
                <rich:column styleClass="action">
                    <f:facet name="header">A&#231;&#227;o</f:facet>
                    
                    <h:outputLink
                        value="http://#{request.getServerName()}:5080#{_video.url}">
                        <h:outputText value="Download" />
                    </h:outputLink>
                   
                </rich:column>
            </rich:dataTable>
            
    		<rich:jQuery selector="#videosTable tr:odd" query="addClass('odd-row')" />
            <rich:jQuery selector="#videosTable tr:even" query="addClass('even-row')" />
            <rich:jQuery selector="#videosTable tr" 
                query="mouseover(function(){jQuery(this).addClass('active-row')})"/>
            <rich:jQuery selector="#videosTable tr" 
                query="mouseout(function(){jQuery(this).removeClass('active-row')})"/>                        
        </h:form>
    </rich:tab>
</rich:tabPanel>    
<rich:tabPanel switchType="ajax" rendered="#{exameHome.managed}">
        <!-- <h:outputLink
                value="http://192.168.10.238:5080/transmissao/Base_Exames/Pac1/videos/201552410452833.flv">
                        <h:outputText value="Link1" />
        </h:outputLink>-->
    <rich:tab label="Imagens">
        <h:form styleClass="association" id="imagensChildren">
        

                
        <h:outputText value="N&#227;o h&#225; imagens associadas a este exame."
                       rendered="#{empty exameHome.imageMetaInformationList}"/>
            <!-- <h:outputText value="#{exameHome.exameSubDirectory}" rendered="#{empty exameHome.imageMetaInformationList}"/>-->

            <rich:dataGrid id="imagensList" value="#{exameHome.imageMetaInformationList}" var="_arquivo" columns="3" elements="60" width="800" border="0" first="0">
				 <rich:modalPanel id="panel" width="780" height="520" zindex="9999" autosized="true" style="text-align: center">
                    <f:facet name="header">
                        <h:panelGroup>
                            <h:outputText value="Imagem"></h:outputText>
                        </h:panelGroup>
                    </f:facet>
                    <f:facet name="controls">
                        <h:panelGroup>
                            <h:graphicImage value="/img/close.png" styleClass="hidelink" id="hidelink"/>
                            <rich:componentControl for="panel" attachTo="hidelink" operation="hide" event="onclick"/>
                        </h:panelGroup>
                    </f:facet>
		        	<h:outputLink
                       value="http://#{request.getServerName()}:5080#{_arquivo.url}"
                       target="_new">
                       <h:outputText value="Download"  style="font-size: 20px; font-weight: bold;"/>
                   </h:outputLink>
                   <br></br>
                   <br></br>
					<!-- <s:graphicImage value="#{_arquivo.img}" width="780" height="480" />-->
					<h:graphicImage value="http://#{request.getServerName()}:5080#{_arquivo.url}" width="780" height="480" />
                </rich:modalPanel>

                    <h:outputLink
                       value="http://#{request.getServerName()}:5080#{_arquivo.url}"
                       target="_new">
                       <h:outputText value="Download" />
                   </h:outputLink>
                   <br></br>
                   <br></br>                   
                <h:outputLink value="#" id="link">
                    <a:outputPanel id="gallery" rendered="#{_arquivo.img != null}">
                        <!-- <s:graphicImage value="#{_arquivo.img}" width="120" />-->
                        <h:graphicImage value="http://#{request.getServerName()}:5080#{_arquivo.url}" width="120" />
                    </a:outputPanel>
                    <rich:jQuery selector="#gallery img" query="addClass('pic-normal')"/>
                    <rich:jQuery selector="#gallery img" query="wrap('&lt;div class=\'wrap1\'&gt;&lt;/div&gt;')" />
                    <rich:jQuery selector="#gallery img" query="mouseover(function(){enlargePic(this)})"/>
                    <rich:jQuery selector="#gallery img" query="mouseout(function(){normalPic(this)})"/>
                    
                    <rich:jQuery name="enlargePic" timing="onJScall" query="stop().animate({width:'180px'})" />
                    <rich:jQuery name="normalPic" timing="onJScall" query="stop().animate({width:'120px'})" />
                    
                    <rich:componentControl for="panel" attachTo="link" operation="show" event="onclick"/>
                </h:outputLink>
            </rich:dataGrid>
        </h:form>
    </rich:tab>
</rich:tabPanel>                      
<rich:tabPanel switchType="ajax" rendered="#{exameHome.managed}">

    <rich:tab label="Laudos">
        <h:form styleClass="association" id="laudosChildren">

            <h:outputText value="N&#227;o h&#225; laudos associados a este exame."
                       rendered="#{empty exameHome.laudos}"/>

            <rich:dataTable value="#{exameHome.laudos}"
                           var="_laudo"
                      rendered="#{not empty exameHome.laudos}"
                    rowClasses="rvgRowOne,rvgRowTwo"
                            id="laudosTable">
                <rich:column sortBy="#{_laudo.dtLaudo}">
                    <f:facet name="header">Data do Laudo</f:facet>
                    <h:outputText value="#{_laudo.dtLaudo}">
                        <s:convertDateTime type="both" dateStyle="short" pattern="dd/MM/yyyy"/>
                    </h:outputText>
                </rich:column>
                <!-- <rich:column sortBy="#{_laudo.resultado}">
                    <f:facet name="header">Conte&#250;do do Laudo</f:facet>
                    <h:outputText value="#{_laudo.resultado}"/>
                </rich:column>-->
                <rich:column sortBy="#{_laudo.observacao}">
                    <f:facet name="header">Observa&#231;&#245;es</f:facet>
                    <h:outputText value="#{_laudo.observacao}"/>
                </rich:column>
                
                <rich:column styleClass="action">
                    <f:facet name="header">Laudo</f:facet>
                    
                    <s:link
                        view="/protected/Laudo.xhtml">
                        <h:outputText value="Ver" />
                        <f:param name="laudoIdLaudo"
                            value="#{_laudo.idLaudo}"/>
                    </s:link>
                   
                </rich:column>
            </rich:dataTable>
        </h:form>
    </rich:tab>
</rich:tabPanel>
    <h:form>
    
    <div class="actionButtons">
    
    	
    	<s:button value="Voltar" style="width:100px;" propagation="end" view="/protected/ExameList.xhtml"/>

    </div>
    
    </h:form>

   </ui:define>
   

</ui:composition>
